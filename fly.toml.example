# =============================================================================
# fly.toml - fly.io デプロイ設定
# =============================================================================
# 使い方:
#   1. このファイルを fly.toml にコピー
#   2. app = "your-app-name" を設定
#   3. fly secrets set で環境変数を設定
#   4. fly deploy
# =============================================================================

app = "your-app-name"
primary_region = "nrt"  # 東京リージョン

[build]
  [build.args]
    VERSION = "dev"
    COMMIT = "unknown"
    BUILD_DATE = "unknown"

[env]
  PORT = "8080"
  # SERVER_ADDR は fly secrets で設定 (例: https://your-app-name.fly.dev)
  # SMTP_* は fly secrets で設定
  # WEBAUTHN_* は fly secrets で設定

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = "stop"
  auto_start_machines = true
  min_machines_running = 0

  [http_service.concurrency]
    type = "connections"
    hard_limit = 25
    soft_limit = 20

[[vm]]
  memory = "256mb"
  cpu_kind = "shared"
  cpus = 1

[mounts]
  source = "data"
  destination = "/app/data"

# =============================================================================
# 初回セットアップ手順:
# =============================================================================
# 1. fly apps create your-app-name
# 2. fly volumes create data --region nrt --size 1
# 3. fly secrets set \
#      SERVER_ADDR=https://your-app-name.fly.dev \
#      ADMIN_EMAIL=admin@example.com \
#      SMTP_HOST=smtp.example.com \
#      SMTP_PORT=587 \
#      SMTP_USERNAME=user \
#      SMTP_PASSWORD=pass \
#      SMTP_FROM=noreply@example.com \
#      WEBAUTHN_RP_ID=your-app-name.fly.dev \
#      WEBAUTHN_ALLOWED_ORIGINS=https://your-app-name.fly.dev
# 4. fly deploy
# =============================================================================
